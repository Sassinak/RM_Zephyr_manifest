# Copyright (c) 2025 Sassinak
# SPDX-License-Identifier: Apache-2.0

description:
  Custom CAN-controlled DJI motor device.


compatible: "rp,dji-can-motor"

properties:
  can-bus:
    type: phandle
    required: true
    description: |
      Reference to the CAN controller used to communicate with the motor.
      On STM32H7 this is typically one of: &fdcan1, &fdcan2, &fdcan3.

  rx-manager:
    type: phandle
    required: false
    description: |
      Reference to a shared CAN RX manager (rp,can-rx-manager) bound to the same can-bus.
      When present, motor drivers should receive frames through the manager instead of
      creating their own RX threads/message queues.

  can-fd:
    type: boolean
    description: |
      Enable CAN FD framing for the motor (up to 64 data bytes).
      If absent, classic CAN (up to 8 data bytes) is assumed.

  label:
    type: string
    description: |
      Human readable string describing this motor.

  tx-id:
    type: int
    required: true
    description: |
      CAN identifier used when sending commands to the motor.
      By default this is interpreted as an 11-bit (standard) ID unless
      the 'extended-id' property is present.

  rx-id:
    type: int
    required: true
    description: |
      CAN identifier expected in frames received from the motor.

  motor-id:
    type: string
    required: true
    description: |
      Unique identifier string for application use (e.g. "chassis_FL").

  control-mode:
    type: string
    required: true
    enum:
      - "torque"                # 扭矩控制模式
      - "velocity"              # 速度控制模式
    description: |
      Control mode of the motor.
