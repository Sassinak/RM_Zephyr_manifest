source [find interface/cmsis-dap.cfg]

transport select swd

source [find target/stm32h7x.cfg]

adapter speed 10000

# 只为CPU目标配置RTT（避免重复配置）
proc configure_rtt_for_cpu {} {
    echo "Configuring RTT for CPU target..."
    
    # 配置RTT事件处理 - 只在CPU目标上配置
    stm32h7x.cpu0 configure -event gdb-attach {
        echo "GDB attached - setting up RTT..."
        setup_rtt
    }
    
    stm32h7x.cpu0 configure -event reset-init {
        echo "Reset-init: Setting up RTT..."
        setup_rtt
    }
}

# 初始化完成后配置RTT
init
after 300 configure_rtt_for_cpu
